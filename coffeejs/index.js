// Generated by CoffeeScript 1.6.3
$(document).ready(function() {
  var calibri, close_others, georgia, today_pages;
  georgia = 'font-family: "Big Caslon", "Book Antiqua", "Palatino Linotype", Georgia, serif;';
  calibri = 'font-family: Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif;';
  window.blue = colourscheme.blues(0.6);
  window.notblue = colourscheme.browns(0.6);
  close_others = function() {
    var obj;
    obj = {
      active: false,
      pinned: false,
      currentWindow: true,
      url: "chrome://newtab/"
    };
    return chrome.tabs.query(obj, function(tabs) {
      return tabs.forEach(function(t) {
        return chrome.tabs.remove(t.id);
      });
    });
  };
  window.get_times = function() {
    var morning, night, now;
    morning = new Date();
    if (morning.getHours() < 8) {
      morning.setDate(morning.getDate() - 1);
    }
    morning.setHours(7);
    morning.setMinutes(50);
    morning = morning.getTime();
    now = new Date().getTime();
    night = new Date();
    night.setHours(23);
    night.setMinutes(0);
    night = night.getTime();
    return {
      morning: morning,
      now: now,
      night: night,
      delta_now: now - morning,
      delta_day: night - morning
    };
  };
  today_pages = function(cb) {
    var times;
    if (cb == null) {
      cb = function() {};
    }
    times = get_times();
    return chrome.history.search({
      text: "",
      startTime: times.morning,
      endTime: times.now,
      maxResults: 2000
    }, function(tabs) {
      $("#pagecount").html(tabs.length);
      tabs = tabs.reverse();
      return cb(tabs);
    });
  };
  $("body").html("<div id=\"timeline\" style=\"position:absolute; margin:0px 10% 0px 10%; width:80%; bottom:120px; text-align:center;\">\n</div>\n\n<table style=\"position:absolute; margin:0px; width:90%; bottom:70px; color:grey; text-align:center; min-width:200px;\">\n  <tr>\n\n    <td style=\"width:200px;\" >\n      <div style=\"font-size:69px;\" id=\"pagecount\">\n        0\n      </div>\n      <span style=\"display:inline-block; padding:3px; color:white; color:" + blue + "; font-size:20px;\">\n        pages\n      </span>\n      <div style=\"font-size:15px; color:grey;\">\n        since 8am\n      </span>\n    </td>\n\n    <td id=\"timecount\" style=\"width:200px;\" >\n    </td>\n\n    <td style=\"width:200px;\" id=\"\">\n    </td>\n    <td style=\"width:200px;\" id=\"\">\n    </td>\n  </tr>\n</table>\n<div id=\"color1\" style=\"position:absolute; width:100px; height:28px; bottom:30px; border-radius:3px 3px 3px 3px; left:100px; background-color:" + blue + "; \"></div>\n<div id=\"color2\" style=\"position:absolute; width:75px; height:20px; bottom:24px; border-radius:3px 3px 3px 3px; left:150px; background-color:" + notblue + "; \"></div>");
  close_others();
  return today_pages(function(tabs) {
    return timeline(tabs, $("#timeline")[0]);
  });
});
